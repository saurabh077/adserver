BASE_DIR=..
BASE=.
BIN=bin
OBJ=obj
INC=include
DB=db
SRC=src
UTIL=util
CFLAGS= -lodbc -lfcgi -Wall -Werror -Wextra 

INCLUDES= -I$(DB)/include \
		 -Iinclude 

OBJS = \
	$(OBJ)/db_connection.o \
	$(OBJ)/fetch_url.o \
	$(OBJ)/main.o \
	$(OBJ)/parse_query.o

BINS = \
	$(BIN)/main.cgi

all: make_dirs $(OBJS) $(BINS)


make_dirs: 
	@echo "----------------------------"
	@echo "CREATING REQUIRED DIRECTORIES"
	@echo "----------------------------"
	mkdir -p $(OBJ) $(BIN)

$(BIN)/main.cgi: $(SRC)/main.c  $(OBJ)/db_connection.o $(OBJ)/fetch_url.o $(OBJ)/parse_query.o
	gcc -lfcgi $^ $(CFLAGS) $(INCLUDES) -o $@

$(OBJ)/db_connection.o: $(DB)/db_connection.c
	gcc -c $(CFLAGS) $(INCLUDES) $^ -o $@ 

$(OBJ)/fetch_url.o: $(UTIL)/fetch_url.c
	gcc -c $(CFLAGS) $(INCLUDES) $^ -o $@

$(OBJ)/main.o: $(SRC)/main.c
	gcc -c $(CFLAGS) $(INCLUDES) $^ -o $@

$(OBJ)/parse_query.o: $(UTIL)/parse_query.c
	gcc -c -lfcgi $(INCLUDES) $< -o $@

clean:
	@echo "----------------------------------------------------------------------------------"
	@echo "===============================CLEANING $(BIN)===================================="
	@echo "----------------------------------------------------------------------------------"
	rm -f $(BINS)
	@echo "----------------------------------------------------------------------------------"
	@echo "================================CLEAN $(BIN) COMPLETE============================="
	@echo "----------------------------------------------------------------------------------"
	@echo "----------------------------------------------------------------------------------"
	@echo "==============================CLEANING $(OBJ)====================================="
	@echo "----------------------------------------------------------------------------------"
	rm -f $(OBJS)
	@echo "----------------------------------------------------------------------------------"
	@echo "=============================CLEAN $(OBJ) COMPLETE================================"
	@echo "----------------------------------------------------------------------------------"

clobber:
	@echo "---------------------------------------------------------------------------------"
	@echo "================================REMOVING $(BIN)=================================="
	@echo "---------------------------------------------------------------------------------"
	rm -rf $(BIN)
	@echo "---------------------------------------------------------------------------------"
	@echo "==============================REMOVE $(BIN) COMPLETE============================="
	@echo "---------------------------------------------------------------------------------"
	@echo "---------------------------------------------------------------------------------"
	@echo "==============================REMOVING $(OBJ)===================================="
	@echo "---------------------------------------------------------------------------------"
	rm -rf $(OBJ)
	@echo "---------------------------------------------------------------------------------"
	@echo "==============================REMOVE $(OBJ) COMPLETE============================="
	@echo "---------------------------------------------------------------------------------"

